# Исправление проблемы дублирования UUID при синхронизации

## Проблема

При синхронизации данных между мобильным приложением и backend возникала проблема дублирования записей из-за несоответствия UUID:

1. **Клиент создавал счет** с `uuidv4()` и `syncedAt = undefined`
2. **Backend создавал новый UUID** вместо использования переданного `id`
3. **При загрузке** `upsertAccount` не находил счет по `id` и создавал дубликат
4. **Результат**: множественные копии одних и тех же счетов

## Решение

### 1. Backend изменения

Исправлены все контроллеры для поддержки переданных `id` от клиента:

- `accounts.controller.ts` - метод `createAccount`
- `categories.controller.ts` - метод `createCategory`  
- `transactions.controller.ts` - метод `createTransaction`
- `debts.controller.ts` - метод `createDebt`

### 2. Модели данных

Обновлены интерфейсы `CreationAttributes` для всех моделей:

- `Account.ts` - `AccountCreationAttributes`
- `Category.ts` - `CategoryCreationAttributes`
- `Transaction.ts` - `TransactionCreationAttributes`
- `Debt.ts` - `DebtCreationAttributes`

### 3. Логика синхронизации

Теперь backend:
1. Проверяет существование записи по переданному `id`
2. Если запись существует - обновляет её
3. Если записи нет - создает новую с переданным `id`
4. Устанавливает `synced_at` для предотвращения повторной синхронизации

## Применение исправления

### 1. Очистка дублированных данных

Выполните SQL скрипт для очистки существующих дубликатов:

```sql
-- Выполнить скрипт: scripts/clean-duplicate-accounts.sql
```

### 2. Перезапуск сервера

```bash
npm run build
npm start
```

### 3. Проверка синхронизации

После применения исправления:
- Новые записи будут создаваться с правильными UUID
- Дублирование прекратится
- Существующие дубликаты будут очищены

## Тестирование

1. Создайте новый счет в мобильном приложении
2. Проверьте, что при синхронизации не создается дубликат
3. Убедитесь, что `synced_at` устанавливается корректно

## Обратная совместимость

Исправление полностью обратно совместимо:
- Клиенты без `id` продолжат работать (будет сгенерирован новый UUID)
- Клиенты с `id` будут использовать переданный UUID
- Существующие данные не пострадают 