# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Backend

## üê≥ Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–∞—è —Å–±–æ—Ä–∫–∞ (Dockerfile)

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t cashcraft-backend .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -d \
  --name cashcraft-backend \
  -p 3000:3000 \
  -e NODE_ENV=production \
  -e DATABASE_URL=your_database_url \
  -e JWT_SECRET=your_jwt_secret \
  cashcraft-backend
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ (Dockerfile.multi-stage)

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ —Å –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–æ–π —Å–±–æ—Ä–∫–æ–π
docker build -f Dockerfile.multi-stage -t cashcraft-backend .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -d \
  --name cashcraft-backend \
  -p 3000:3000 \
  -e NODE_ENV=production \
  -e DATABASE_URL=your_database_url \
  -e JWT_SECRET=your_jwt_secret \
  cashcraft-backend
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ docker-compose

```bash
# –ó–∞–ø—É—Å–∫ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—É—é —Å–±–æ—Ä–∫—É)
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://user:password@host:port/database
JWT_SECRET=your-super-secret-jwt-key
CORS_ORIGIN=https://your-frontend-domain.com
```

## üöÄ Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm ci

# –°–±–æ—Ä–∫–∞ TypeScript
npm run build

# –û—á–∏—Å—Ç–∫–∞ dev dependencies
npm prune --production
```

### 2. –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –≤ production
npm run start:prod
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
curl http://localhost:3000/health

# –û—Ç–≤–µ—Ç: {"status":"ok","timestamp":"2024-01-01T00:00:00.000Z"}
```

### Ping Test

```bash
# –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl http://localhost:3000/ping

# –û—Ç–≤–µ—Ç: pong
```

## üõë Graceful Shutdown

–°–µ—Ä–≤–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:

- `SIGTERM` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- `SIGINT` - Ctrl+C
- `SIGUSR2` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ nodemon

### –õ–æ–≥–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:

```
üõë Received SIGTERM. Starting graceful shutdown...
üì° HTTP server closed
üóÑÔ∏è Database connection closed
‚úÖ Graceful shutdown completed
```

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: tsc: not found

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Dockerfile –∏–ª–∏ –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—É—é —Å–±–æ—Ä–∫—É

```bash
# –î–ª—è Railway/Production
docker build -f Dockerfile.multi-stage -t cashcraft-backend .

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
docker build -t cashcraft-backend .
```

### –ü—Ä–æ–±–ª–µ–º–∞: npm warn config production

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--omit=dev` –≤–º–µ—Å—Ç–æ `--production`

```bash
npm ci --only=production --omit=dev
```

### –ü—Ä–æ–±–ª–µ–º–∞: npm error signal SIGTERM

**–†–µ—à–µ–Ω–∏–µ**: –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ. Graceful shutdown —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç

**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
export PORT=3001
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ health check endpoints
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ connection pooling
4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
5. **SSL**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ reverse proxy —Å SSL

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤:

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
docker stats cashcraft-backend

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker logs -f cashcraft-backend
```

## üèóÔ∏è –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É Dockerfile

### Dockerfile (–ø—Ä–æ—Å—Ç–æ–π)
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Å–±–æ—Ä–∫–∞
- ‚ö†Ô∏è –ë–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞

### Dockerfile.multi-stage (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- ‚úÖ –ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞
- ‚úÖ –¢–æ–ª—å–∫–æ production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚ö†Ô∏è –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Å–±–æ—Ä–∫–∞
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production 